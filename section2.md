# 高可用の概念と理論

試験ではネットワークで接続された複数台の物理的な論理的な1つのグループ押して扱うサーバクラスタが対象

ここのマシンはクラスタノード、クラスタメンバと呼ばれる

目的に応じて

* 高可用クラスタ
* 負荷分散クラスタ(ロードバランサークラスタ)
* ストレージクラスタ
* ハイパフォーマンスクラスタ

などのタイプがある

### 可用性指標

MTBF 平均故障間隔 = 総稼働時間/総故障件数
MTTR 平均復旧時間 = 総復旧時間/総故障件数

稼働率  = MTBF/(MTBF+MTTR)

## ロードバランスクラスタ

負荷分散クラスタとも呼ばれる

サービス亭用サーバを複数用意してリクエストをそれに振り分け

レスポンス向上、可用性の向上が期待できる

DSR ロードバランサを経由せずに直接レスポンスを返却

## フェイルオーバークラスタ

サービス提供しているサーバに障害が発生した際、別サーバでサービスを提供できるサーバクラスタ

### アクティブ/パッシブとアクティブ/アクティブ

アクティブ/パッシブ　待機ノードは停止状態。構成設計や運用が単純。ランニングコストが低い。ダウンタイムが長い

アクティブ/アクティブ　待機ノードは起動状態。サービスは稼働/非稼働の2パターン。ノード間はハートビートで動作状況を監視

### シェアードディスクとシェアードナッシング

共通のデータを取り扱う際の解決策の方式

シェアードディスク　複数ノードで１つのディスクを共有
シェアードナッシング　共有ディスクを使わない

データの引き継ぎ、拡張性、処理性能にそれぞれメリットデメリットあり

## クラスタアーキテクチャの設計

### スプリットブレイン

障害時に複数ノードがマスターになってしまうこと。ハートビート通信の中断などで発生。共有リソースのアクセスなどで問題が起きる可能性あり

### フェンシング

障害ノードをクラスタから切り離す仕組み

一般的にクラスタ基盤が提供するフェンスデーモンと呼ばれるサービスで実行される

* パワーフェンシング　障害ノードの電源を切る
* スイッチフェンシング　障害ノードの通信をスイッチ遮断する
* GNBDフェンシング GNBDサーバに対するアクセスを無効にする

### クオーラム

ネットワーク障害などでクラスタの分断が発生した場合。スプリットブレインになってしまうので分断されたクラスタに一定数正常ノードが存在していれば、そのクラスタを有効なグループとしてみなし、有効でないグループをフェンシングする。

ノードマジョリティともいう

偶数ノードのクラスタの場合、専用のディスクに書き込みを行っているかで区オーラムを判定する方法もある（ディスクマジョリティ）

### ディザスタ・リカバリ

地震、家事、テロを想定した災害からの復旧を示す言葉

* 複数の遠隔地にスタンバイサーバを配置
* データのバックアップを取る

RPO（Recovery Point Objective) 過去のどの地点まで復旧するのか
RTO(Recovery Time Objective) いつまでに復旧すればよいか